## 性能测试

| 节点数量 | 代码 | 服务器和客户端类型                                           | 统计变量                          | 测试方法                                                     |
| -------- | ---- | ------------------------------------------------------------ | --------------------------------- | ------------------------------------------------------------ |
| 3        | c++  | 包括四种组合： 1.异步服务器/异步客户端 2.异步服务器/同步客户端 3.同步服务器/异步客户端 4.同步服务器/同步客户端 | 1.数据的数量； 2.每条数据的长度； | 1.根据配置文件创建网络拓扑； 2.在此生命周期内，向对端发送数据和读取对端发送过来的数据（每个节点使用一个线程发送/接收）； 3.统计一定数量（可变）的数据（可变）在此网络拓扑结构中，收发所消耗的时间； |



## 编译

进入测试目录`channel-sdk/test/c++/performance_test`，然后执行；

### 创建编译目录

```bash
mkdir build && cd build
```

### 编译选项说明

注意：编译选项可组合使用；

- 指定服务器类型

  包括异步和同步两种类型；

  ```bash
  cmake -DASYNC_SERVER=1 ..
  ```

  > 说明：
  >
  > - ASYNC_SERVER=1表示使用异步服务器；
  > - 不指定时（默认）表示使用同步服务器；



- 指定客户端类型

  包括异步和同步两种类型；

  ```bash
  cmake -DASYNC_CLIENT=1 .. 
  ```

  > 说明：
  >
  > - ASYNC_CLIENT=1表示使用异步客户端（不需要等待服务器的响应，直接返回）；
  > - 不指定时（默认）表示使用同步客户端；



### 执行编译

```bash
make
```

> 编译成功后在build目录下生成so文件，包括io库`libexternal_io.so`和p0_cs，p1_cs，p2_cs可执行文件；



## 测试步骤

### 测试前准备

- 复制测试脚本

  ```bash
  cp ../script/*.sh .
  ```

- 复制节点配置文件

  ```bash
  cp ../config.json .
  ```

- 复制测试数据文件

  ```bash
  cp ../data_file/*.txt .
  ```

  

### 开始测试

- 执行测试脚本

  ```bash
  ./run_test.sh 512 10000
  ```

  > 说明：
  >
  > - run_test.sh：测试脚本
  > - 512：表示每条数据的长度，根据此参数，获取当前目录下文件名为`512_bytes.txt`的内容，当作每次发送的数据内容；
  > - 10000：发送和读取数据的次数；

- 停止测试脚本

  ```bash
  ./killall.sh
  ```

  > 测试脚本跑完之后，执行此脚本，停止进程，并观察是否有time_wait的连接没有关闭；

